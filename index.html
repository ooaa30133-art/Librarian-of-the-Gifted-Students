<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ - Ù…ÙŠØ²Ø© Ø§Ù„Ø¨Ø­Ø«</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Ù…ÙƒØªØ¨ØªÙŠ">
    <link rel="apple-touch-icon" href="/Librarian-of-the-Gifted-Students/icons/icon-192x192.png">
    <link rel="manifest" href="/Librarian-of-the-Gifted-Students/manifest.json">
    <meta name="theme-color" content="#673AB7">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        :root {
            --bg-color: #121212; --surface-color: #1e1e1e; --primary-color: #bb86fc;
            --secondary-color: #03dac6; --text-color: #ffffff; --text-muted: #b3b3b3;
            --border-color: #333333; --danger-color: #cf6679; --success-color: #4caf50;
            --warning-color: #ff9800; --info-color: #2196f3;
        }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; min-height: 100vh; overflow-x: hidden; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        aside { width: 250px; flex-shrink: 0; background-color: var(--surface-color); border-left: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 100; transition: all 0.3s ease; }
        .sidebar-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 15px; }
        aside h2 { color: var(--primary-color); margin: 0; font-size: 22px; white-space: nowrap; }
        aside ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; }
        aside ul li { padding: 15px 20px; cursor: pointer; transition: 0.3s; border-bottom: 1px solid var(--border-color); font-weight: 500; display: flex; align-items: center; }
        aside ul li .icon { font-size: 20px; margin-left: 12px; }
        aside ul li:hover, aside ul li.active { background-color: rgba(187, 134, 252, 0.1); color: var(--primary-color); }

        /* Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¹Ù…Ù„ */
        main { flex: 1; min-width: 0; padding: clamp(15px, 3vw, 30px); display: flex; flex-direction: column; background-color: var(--bg-color); }
        .section { display: none; animation: fadeIn 0.4s ease; width: 100%; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h1 { border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; font-size: clamp(20px, 4vw, 24px); }

        /* Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .search-container { position: relative; margin-bottom: 15px; width: 100%; }
        .search-input { width: 100%; padding: 12px 40px 12px 15px; background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 8px; font-family: 'Tajawal'; outline: none; transition: 0.3s; }
        .search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 5px rgba(187, 134, 252, 0.3); }
        .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); pointer-events: none; }

        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(min(100%, 250px), 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background-color: var(--surface-color); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 20px; width: 100%; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(min(100%, 250px), 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 8px; font-family: 'Tajawal'; outline: none; }
        
        button { background-color: var(--primary-color); color: #000; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: 0.3s;}
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        .btn-full { width: 100%; margin-top: 10px; }
        .btn-excel { background-color: var(--success-color); color: white; width: 100%; }
        .btn-print { background-color: var(--info-color); color: white; width: 100%; }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        .table-container { width: 100%; overflow-x: auto; border-radius: 10px; border: 1px solid var(--border-color); }
        table { width: 100%; border-collapse: collapse; min-width: 700px; background-color: var(--surface-color); }
        th, td { padding: 14px 15px; text-align: right; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        th { background-color: rgba(255, 255, 255, 0.05); color: var(--secondary-color); }

        @media screen and (max-width: 992px) {
            body { flex-direction: column; }
            aside { width: 100% !important; height: auto; flex-direction: row; position: sticky; top: 0; }
            .sidebar-header { display: none; }
            aside ul { flex-direction: row; overflow-x: auto; flex: 1; }
            aside ul li { border-bottom: none; border-left: 1px solid var(--border-color); white-space: nowrap; }
            aside ul li .text { display: none; }
        }

        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px;}
        .toast { background-color: var(--surface-color); color: white; padding: 15px; border-radius: 8px; border-right: 4px solid var(--primary-color); margin-top: 10px; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù‚Ø³Ù… Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… */
        .guide-list { line-height: 2; margin-top: 15px; padding-right: 20px; }
        .guide-list li { margin-bottom: 10px; }
        .guide-list strong { color: var(--primary-color); }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <aside id="sidebar">
        <div class="sidebar-header">
            <h2>Ù…ÙƒØªØ¨ØªÙŠ</h2>
        </div>
        <ul>
            <li class="nav-item active" onclick="switchTab('dashboard')"><span class="icon">ğŸ“Š</span><span class="text">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></li>
            <li class="nav-item" onclick="switchTab('books')"><span class="icon">ğŸ“–</span><span class="text">Ø§Ù„ÙƒØªØ¨</span></li>
            <li class="nav-item" onclick="switchTab('students')"><span class="icon">ğŸ‘¥</span><span class="text">Ø§Ù„Ø·Ù„Ø§Ø¨</span></li>
            <li class="nav-item" onclick="switchTab('borrow')"><span class="icon">ğŸ”„</span><span class="text">Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø©</span></li>
            <li class="nav-item" onclick="switchTab('reports')"><span class="icon">ğŸ“‘</span><span class="text">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span></li>
            <li class="nav-item" onclick="switchTab('guide')"><span class="icon">ğŸ’¡</span><span class="text">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</span></li>
        </ul>
    </aside>

    <main>
        <section id="dashboard" class="section active">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <div class="cards-grid">
                <div class="card"><h3 id="stat-total-books">0</h3><p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØªØ¨</p></div>
                <div class="card"><h3 id="stat-available-books" style="color: var(--success-color);">0</h3><p>ÙƒØªØ¨ Ù…ØªØ§Ø­Ø©</p></div>
                <div class="card"><h3 id="stat-total-students" style="color: var(--secondary-color);">0</h3><p>Ø§Ù„Ø·Ù„Ø§Ø¨</p></div>
            </div>
        </section>

        <section id="books" class="section">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØªØ¨</h1>
            <div class="card">
                <form id="form-book">
                    <div class="form-grid">
                        <input type="text" id="book-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨" required>
                        <input type="text" id="book-author" placeholder="Ø§Ù„Ù…Ø¤Ù„Ù" required>
                        <input list="categories-list" id="book-category" placeholder="Ø§Ù„ÙØ¦Ø©...">
                        <datalist id="categories-list"></datalist>
                    </div>
                    <button type="submit" class="btn-full">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨</button>
                </form>
            </div>
            
            <div class="search-container">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="search-books" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¤Ù„Ù..." onkeyup="renderBooks()">
            </div>

            <div class="card table-container">
                <table>
                    <thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù…Ø¤Ù„Ù</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="table-books"></tbody>
                </table>
            </div>
        </section>

        <section id="students" class="section">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <div class="card">
                <form id="form-student">
                    <div class="form-grid">
                        <input type="text" id="student-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
                        <input type="text" id="student-class" placeholder="Ø§Ù„ØµÙ">
                    </div>
                    <button type="submit" class="btn-full">â• ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨</button>
                </form>
            </div>

            <div class="search-container">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="search-students" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø§Ø³Ù…..." onkeyup="renderStudents()">
            </div>

            <div class="card table-container">
                <table>
                    <thead><tr><th>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØµÙ</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="table-students"></tbody>
                </table>
            </div>
        </section>

        <section id="borrow" class="section">
            <h1>Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø§Øª</h1>
            <div class="card">
                <form id="form-borrow">
                    <div class="form-grid">
                        <select id="borrow-student" required><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨...</option></select>
                        <select id="borrow-book" required><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…ØªØ§Ø­...</option></select>
                        <input type="date" id="borrow-due-date" required>
                    </div>
                    <button type="submit" class="btn-full">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø©</button>
                </form>
            </div>

            <div class="search-container">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="search-borrows" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³ØªØ¹Ø§Ø±Ø© Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ù„ÙƒØªØ§Ø¨..." onkeyup="renderBorrows()">
            </div>

            <div class="card table-container">
                <table>
                    <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ÙƒØªØ§Ø¨</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="table-borrows"></tbody>
                </table>
            </div>
        </section>

        <section id="reports" class="section">
            <h1>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØµØ¯ÙŠØ±</h1>
            <div class="cards-grid">
                <div class="card">
                    <h3>Excel</h3>
                    <button class="btn-excel" onclick="exportSmartExcel('books')">ğŸ“Š ÙƒØªØ¨</button><br><br>
                    <button class="btn-excel" onclick="exportSmartExcel('borrows')">ğŸ“Š Ø¥Ø¹Ø§Ø±Ø§Øª</button>
                </div>
                <div class="card">
                    <h3>Ø·Ø¨Ø§Ø¹Ø©</h3>
                    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                </div>
                <div class="card">
                    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                    <button class="btn-full" onclick="resetAllData()" style="background-color: var(--danger-color); color: white;">ğŸ—‘ï¸ ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
            </div>
        </section>

        <section id="guide" class="section">
            <h1>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h1>
            <div class="card">
                <h3 style="color: var(--secondary-color); margin-bottom: 10px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ! ğŸ‘‹</h3>
                <p>Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØµÙ…Ù… Ù„ÙŠÙƒÙˆÙ† Ø¨Ø³ÙŠØ·Ø§Ù‹ ÙˆØ³Ø±ÙŠØ¹Ø§Ù‹ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ù…ÙƒØªØ¨ØªÙƒ Ø¨ÙƒÙØ§Ø¡Ø©. Ø¥Ù„ÙŠÙƒ Ø´Ø±Ø­ Ù…Ø¨Ø³Ø· Ù„Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹Ù…Ù„:</p>
                
                <ul class="guide-list">
                    <li><strong>ğŸ“Š Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong> ÙˆØ§Ø¬Ù‡Ø© Ø³Ø±ÙŠØ¹Ø© ØªØ¹Ø·ÙŠÙƒ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØªØ¨ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù…ØªØ§Ø­) ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….</li>
                    <li><strong>ğŸ“– Ø§Ù„ÙƒØªØ¨:</strong> Ù…Ù† Ù‡Ù†Ø§ ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ. Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ù…Ø¤Ù„ÙØŒ ÙˆØ§Ù„ÙØ¦Ø©). ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ ÙƒØªØ§Ø¨ Ù„Ø§Ø­Ù‚Ø§Ù‹ØŒ ÙˆØ­Ø°ÙÙ‡ Ø¥Ø°Ø§ ØªØ·Ù„Ø¨ Ø§Ù„Ø£Ù…Ø±. <i>(Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø¶Ø§ÙØ© ØªÙƒÙˆÙ† "Ù…ØªØ§Ø­Ø©" ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</i>.</li>
                    <li><strong>ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨:</strong> Ù‚Ø¨Ù„ Ø£Ù† ÙŠØ³ØªØ¹ÙŠØ± Ø£ÙŠ Ø·Ø§Ù„Ø¨ ÙƒØªØ§Ø¨Ø§Ù‹ØŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„Ù‡ Ù‡Ù†Ø§ Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ù‡ ÙˆØµÙÙ‡. ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø£Ùˆ Ø­Ø°ÙÙ‡Ù….</li>
                    <li><strong>ğŸ”„ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø©:</strong> Ù„Ø¥Ø¹Ø§Ø±Ø© ÙƒØªØ§Ø¨ØŒ Ù‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ù„Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹) ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒØªØ§Ø¨ (Ø§Ù„Ù…ØªØ§Ø­ ÙÙ‚Ø· Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)ØŒ Ø«Ù… Ø­Ø¯Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹. Ø¹Ù†Ø¯ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„ÙƒØªØ§Ø¨ØŒ Ø§Ø¨Ø­Ø« Ø¹Ù†Ù‡ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ <strong>"Ø¥Ø±Ø¬Ø§Ø¹"</strong> Ù„ÙŠØ¹ÙˆØ¯ Ø§Ù„ÙƒØªØ§Ø¨ Ù„Ø­Ø§Ù„Ø© "Ù…ØªØ§Ø­" ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.</li>
                    <li><strong>ğŸ“‘ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±:</strong> ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ø§Ù„ÙƒØªØ¨ Ø£Ùˆ Ø§Ù„Ø¥Ø¹Ø§Ø±Ø§Øª) Ø¥Ù„Ù‰ Ù…Ù„ÙØ§Øª ExcelØŒ Ø£Ùˆ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ø§Ø´Ø©. ÙƒÙ…Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø± <strong>"ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"</strong> Ù„Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±.</li>
                </ul>

                <div style="margin-top: 20px; padding: 15px; background-color: rgba(255, 152, 0, 0.1); border-right: 4px solid var(--warning-color); border-radius: 8px;">
                    <strong style="color: var(--warning-color);">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø© Ø­ÙˆÙ„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong><br>
                    ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªØ¯Ø®Ù„Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ Ù…ØªØµÙØ­Ùƒ (Local Storage). Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù† ØªØ¶ÙŠØ¹ Ø¥Ø°Ø§ Ø£ØºÙ„Ù‚Øª Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ù‚Ù…Øª Ø¨ØªØ­Ø¯ÙŠØ«Ù‡Ø§. ÙˆÙ„ÙƒÙ†ØŒ <strong>Ø³ØªÙÙ‚Ø¯ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</strong> Ø¥Ø°Ø§ Ù‚Ù…Øª Ø¨Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ (Clear Browsing Data) Ø£Ùˆ Ø¥Ø°Ø§ Ø§Ø³ØªØ®Ø¯Ù…Øª Ø²Ø± "ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª".
                </div>
            </div>
        </section>
    </main>

    <script>
        let db = {
            books: JSON.parse(localStorage.getItem('lib_books')) || [],
            students: JSON.parse(localStorage.getItem('lib_students')) || [],
            borrows: JSON.parse(localStorage.getItem('lib_borrows')) || []
        };

        function saveData() {
            localStorage.setItem('lib_books', JSON.stringify(db.books));
            localStorage.setItem('lib_students', JSON.stringify(db.students));
            localStorage.setItem('lib_borrows', JSON.stringify(db.borrows));
            updateUI();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function renderBooks() {
            const query = document.getElementById('search-books').value.toLowerCase();
            const tb = document.getElementById('table-books'); tb.innerHTML = '';
            
            db.books.filter(b => b.title.toLowerCase().includes(query) || b.author.toLowerCase().includes(query)).forEach(b => {
                const displayId = (b.isbn && b.isbn !== '---') ? b.isbn : '#' + (b.id ? b.id.toString().slice(-4) : '0000');
                tb.innerHTML += `<tr><td>${displayId}</td><td>${b.title}</td><td>${b.author}</td><td>${b.category}</td><td>${b.status}</td><td><button onclick="deleteItem('books','${b.id}')">âŒ</button></td></tr>`;
            });
        }

        function renderStudents() {
            const query = document.getElementById('search-students').value.toLowerCase();
            const ts = document.getElementById('table-students'); ts.innerHTML = '';
            
            db.students.filter(s => s.name.toLowerCase().includes(query)).forEach(s => {
                ts.innerHTML += `<tr><td>#${s.id.slice(-4)}</td><td>${s.name}</td><td>${s.grade}</td><td><button onclick="deleteItem('students','${s.id}')">âŒ</button></td></tr>`;
            });
        }

        function renderBorrows() {
            const query = document.getElementById('search-borrows').value.toLowerCase();
            const tbr = document.getElementById('table-borrows'); tbr.innerHTML = '';
            
            db.borrows.forEach(br => {
                const s = db.students.find(x => x.id === br.studentId);
                const b = db.books.find(x => x.id === br.bookId);
                const sName = s ? s.name : '-';
                const bTitle = b ? b.title : '-';

                if (sName.toLowerCase().includes(query) || bTitle.toLowerCase().includes(query)) {
                    tbr.innerHTML += `<tr><td>${sName}</td><td>${bTitle}</td><td>${br.dueDate}</td><td><button onclick="returnBook('${br.id}','${br.bookId}')">Ø¥Ø±Ø¬Ø§Ø¹</button></td></tr>`;
                }
            });
        }

        function updateUI() {
            document.getElementById('stat-total-books').innerText = db.books.length;
            document.getElementById('stat-available-books').innerText = db.books.filter(b => b.status === 'Ù…ØªØ§Ø­').length;
            document.getElementById('stat-total-students').innerText = db.students.length;

            renderBooks(); renderStudents(); renderBorrows();

            const sSel = document.getElementById('borrow-student'); sSel.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨...</option>';
            db.students.forEach(s => sSel.innerHTML += `<option value="${s.id}">${s.name}</option>`);

            const bSel = document.getElementById('borrow-book'); bSel.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…ØªØ§Ø­...</option>';
            db.books.filter(x => x.status === 'Ù…ØªØ§Ø­').forEach(b => bSel.innerHTML += `<option value="${b.id}">${b.title}</option>`);
        }

        document.getElementById('form-book').onsubmit = (e) => {
            e.preventDefault();
            db.books.push({ id: Date.now().toString(), title: document.getElementById('book-title').value, author: document.getElementById('book-author').value, category: document.getElementById('book-category').value, status: 'Ù…ØªØ§Ø­' });
            e.target.reset(); saveData();
        };

        document.getElementById('form-student').onsubmit = (e) => {
            e.preventDefault();
            db.students.push({ id: Date.now().toString(), name: document.getElementById('student-name').value, grade: document.getElementById('student-class').value });
            e.target.reset(); saveData();
        };

        document.getElementById('form-borrow').onsubmit = (e) => {
            e.preventDefault();
            const bId = document.getElementById('borrow-book').value;
            db.borrows.push({ id: Date.now().toString(), studentId: document.getElementById('borrow-student').value, bookId: bId, borrowDate: new Date().toISOString().split('T')[0], dueDate: document.getElementById('borrow-due-date').value });
            const bIdx = db.books.findIndex(x => x.id === bId);
            db.books[bIdx].status = 'Ù…Ø³ØªØ¹Ø§Ø±';
            saveData();
        };

        function deleteItem(col, id) { if(confirm('Ù…ØªØ£ÙƒØ¯ØŸ')) { db[col] = db[col].filter(x => x.id !== id); saveData(); } }
        function returnBook(brId, bId) {
            db.borrows = db.borrows.filter(x => x.id !== brId);
            const idx = db.books.findIndex(x => x.id === bId);
            if(idx !== -1) db.books[idx].status = 'Ù…ØªØ§Ø­';
            saveData();
        }

        function exportSmartExcel(type) {
            let csvContent = "";
            let data = [];
            
            if(type === 'books') {
                data = db.books.map(b => ({'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': b.title, 'Ø§Ù„Ù…Ø¤Ù„Ù': b.author, 'Ø§Ù„ÙØ¦Ø©': b.category, 'Ø§Ù„Ø­Ø§Ù„Ø©': b.status}));
            } else {
                data = db.borrows.map(br => ({'Ø§Ù„Ø·Ø§Ù„Ø¨': (db.students.find(x => x.id === br.studentId) || {}).name || '-', 'Ø§Ù„ÙƒØªØ§Ø¨': (db.books.find(x => x.id === br.bookId) || {}).title || '-', 'Ø§Ù„ØªØ§Ø±ÙŠØ®': br.dueDate}));
            }

            if(data.length === 0) {
                alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±!");
                return;
            }

            const headers = Object.keys(data[0] || {});
            csvContent += headers.join(",") + "\r\n";
            data.forEach(row => {
                csvContent += headers.map(h => `"${row[h] || ''}"`).join(",") + "\r\n";
            });
            
            const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
            const blob = new Blob([bom, csvContent], { type: 'text/csv;charset=utf-8;' });
            
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Ù…ÙƒØªØ¨ØªÙŠ_${type}.csv`; 
            link.click();
        }

        function resetAllData() {
            const firstConfirm = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ (Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)");
            if (firstConfirm) {
                const secondConfirm = confirm("ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ: Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ØŒ Ø§Ù„Ø·Ù„Ø§Ø¨ØŒ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ");
                if (secondConfirm) {
                    localStorage.removeItem('lib_books');
                    localStorage.removeItem('lib_students');
                    localStorage.removeItem('lib_borrows');
                    
                    db.books = [];
                    db.students = [];
                    db.borrows = [];
                    
                    updateUI();
                    alert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­.");
                }
            }
        }

        updateUI();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/Librarian-of-the-Gifted-Students/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
